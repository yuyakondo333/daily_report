# 今日学んだこと
## 取り組んだ課題
- Webセキュリティについて学ぶ
## わかったこと
### SQLインジェクション

- 発生しうる脅威
SQL インジェクション攻撃により、発生しうる脅威は次のとおりです。
    - データベースに蓄積された非公開情報の閲覧
    個人情報の漏えい 等
    - データベースに蓄積された情報の改ざん、消去
    ウェブページの改ざん、パスワード変更、システム停止 等
    - 認証回避による不正ログイン
    ログインした利用者に許可されている全ての操作を不正に行われる
    - ストアドプロシージャ等を利用した OS コマンドの実行
    システムの乗っ取り、他への攻撃の踏み台としての悪用

- 根本的解決
    - SQL 文の組み立ては全てプレースホルダで実装する。
    - SQL 文の組み立てを文字列連結により行う場合は、エスケープ処理等を行うデータ
    ベースエンジンの API を用いて、SQL 文のリテラルを正しく構成する。
    - ウェブアプリケーションに渡されるパラメータに SQL 文を直接指定しない。
- 保険的解決
    - エラーメッセージをそのままブラウザに表示しない。
    - データベースアカウントに適切な権限を与える。

### OS コマンド・インジェクション

- 発生しうる脅威
    - サーバ内ファイルの閲覧、改ざん、削除
    重要情報の漏えい、設定ファイルの改ざん 等
    - 不正なシステム操作
    意図しない OS のシャットダウン、ユーザアカウントの追加、変更 等
    - 不正なプログラムのダウンロード、実行
    ウイルス、ワーム、ボット等への感染、バックドアの設置 等
    - 他のシステムへの攻撃の踏み台
    サービス不能攻撃、システム攻略のための調査、迷惑メールの送信
- 根本的解決
    - シェルを起動できる言語機能の利用を避ける。
- 保険的対策
    - シェルを起動できる言語機能を利用する場合は、その引数を構成する全ての変数に
    対してチェックを行い、あらかじめ許可した処理のみを実行する。

### パス名パラメータの未チェック／ディレクトリ・トラバーサル

- 発生しうる脅威
    - サーバ内ファイルの閲覧、改ざん、削除
        - 重要情報の漏えい
        - 設定ファイル、データファイル、プログラムのソースコード等の改ざん、削除
- 根本的解決
    - 外部からのパラメータでウェブサーバ内のファイル名を直接指定する実装を避ける。
    - ファイルを開く際は、固定のディレクトリを指定し、かつファイル名にディレクトリ名が含まれないようにする。
- 保険的対策
    - ウェブサーバ内のファイルへのアクセス権限の設定を正しく管理する。
    - ファイル名のチェックを行う。

### セッション管理の不備

- 発生しうる脅威
    - ログイン後の利用者のみが利用可能なサービスの悪用
    不正な送金、利用者が意図しない商品購入、利用者が意図しない退会処理 等
    - ログイン後の利用者のみが編集可能な情報の改ざん、新規登録
    各種設定の不正な変更（管理者画面、パスワード等）、掲示板への不適切な書き込み 等
    - ログイン後の利用者のみが閲覧可能な情報の閲覧
    非公開の個人情報を不正閲覧、ウェブメールを不正閲覧、コミュニティ会員専用の掲示板を不正閲覧 等
- 根本的解決
    - セッション ID を推測が困難なものにする。
    - セッション ID を URL パラメータに格納しない。
    - HTTPS 通信で利用する Cookie には secure 属性を加える。
    - ログイン成功後に、新しくセッションを開始する。
    - ログイン成功後に、既存のセッション ID とは別に秘密情報を発行し、ページの遷移
    ごとにその値を確認する。
- 保険的対策
    - セッション ID を固定値にしない。
    - セッション ID を Cookie にセットする場合、有効期限の設定に注意する。
    

### クロスサイト・スクリプティング

- 発生しうる脅威
    - 本物サイト上に偽のページが表示される
        - 偽情報の流布による混乱
        - フィッシング詐欺による重要情報の漏えい 等
    - ブラウザが保存している Cookie を取得される
        - Cookie にセッション ID が格納されている場合
        さらに利用者へのなりすましにつながる
        - Cookie に個人情報等が格納されている場合、その情報が漏えいする
    - 任意の Cookie をブラウザに保存させられる
        - セッション ID が利用者に送り込まれ
        「セッション ID の固定化」 攻撃に悪用される
- 根本的解決
    - ***HTML テキストの入力を許可しない場合の対策***
        - ウェブページに出力する全ての要素に対して、エスケープ処理を施す。
        - URL を出力するときは、「http://」や 「https://」で始まる
        URL のみを許可する「ホワイトリスト方式」の実装をする。
        - <script>...</script> 要素の内容を動的に生成しない。
        - スタイルシートを任意のサイトから取り込めるようにしない。
    - ***HTML テキストの入力を許可する場合の対策***
        - 入力された HTML テキストから構文解析木を作成し、スクリプトを含まない必要な
        要素のみを抽出する
    - ***全てのウェブアプリケーションに共通の対策***
        - HTTP レスポンスヘッダの Content-Type フィールドに文字コード（charset）を
        指定する。
- 保険的対策
    - ***HTML テキストの入力を許可しない場合の対策***
        - 入力値の内容チェックを行う。
    - ***HTML テキストの入力を許可する場合の対策***
        - 入力された HTML テキストから、スクリプトに該当する文字列を排除する。
    - ***全てのウェブアプリケーションに共通の対策***
        - Cookie 情報の漏えい対策として、発行する Cookie に HttpOnly 属性を加え、
        TRACE メソッドを無効化する。
        - クロスサイト・スクリプティングの潜在的な脆弱性対策として有効なブラウザの機能を有効にするレスポンスヘッダを返す。

### CSRF（クロスサイト・リクエスト・フォージェリ）

- 発生しうる脅威
    - ログイン後の利用者のみが利用可能なサービスの悪用
    不正な送金、利用者が意図しない商品購入、利用者が意図しない退会処理 等
    - ログイン後の利用者のみが編集可能な情報の改ざん、新規登録
    各種設定の不正な変更（管理者画面、パスワード等）、掲示板への不適切な書き込み 等
- 根本的解決
    - 処理を実行するページを POST メソッドでアクセスするようにし、その「hidden パラメータ」に秘密情報が挿入されるよう、前のページを自動生成して、実行ページではその値が正しい場合のみ処理を実行する。
    - 処理を実行する直前のページで再度パスワードの入力を求め、実行ページでは、再
    度入力されたパスワードが正しい場合のみ処理を実行する。
    - Referer が正しいリンク元かを確認し、正しい場合のみ処理を実行する。
- 保険的対策
    - 重要な操作を行った際に、その旨を登録済みのメールアドレスに自動送信する。

### HTTP ヘッダ・インジェクション

- 発生しうる脅威
    - クロスサイト・スクリプティング攻撃により発生しうる脅威と同じ脅威
    - 任意の Cookie 発行
        - Set-Cookie ヘッダを注入された場合、任意の Cookie が発行され、利用者のブラウザに保存される可能性があります。
    - キャッシュサーバのキャッシュ汚染
        - 複数のレスポンスに分割し、任意のレスポンスボディをリバースプロキシ等にキャッシュさせることにより、キャッシュ汚染（ウェブページの差し替え）を引き起こし、ウェブページの改ざんと同じ脅威が生じます。この攻撃を受けたウェブサイトにアクセスする利用者は、この差し替えられた偽のウェブページを参照し続けることになります。クロスサイト・スクリプティング攻撃のように、攻撃を受けた直後の本人のみが影響を受ける場合に比べ、キャッシュ汚染による脅威は、影響を受ける対象が広く、また永続的であることが特徴です。
- 根本的解決
    - ヘッダの出力を直接行わず、ウェブアプリケーションの実行環境や言語に用意されているヘッダ出力用 API を使用する。
    - 改行コードを適切に処理するヘッダ出力用 API を利用できない場合は、改行を許可
    しないよう、開発者自身で適切な処理を実装する。
- 保険的対策
    - 外部からの入力の全てについて、改行コードを削除する。

### メールヘッダ・インジェクション

- 発生しうる脅威
    - メールの第三者中継
- 根本的解決
    - メールヘッダを固定値にして、外部からの入力はすべてメール本文に出力する。
    - メールヘッダを固定値にできない場合、ウェブアプリケーションの実行環境や言語に用意されているメール送信用 API を使用する。
    - HTML で宛先を指定しない
- 保険的対策
    - 外部からの入力の全てについて、改行コードを削除する。

### クリックジャッキング

- 発生しうる脅威
    - ログイン後の利用者のみが利用可能なサービスの悪用
        - 利用者が意図しない情報発信、利用者が意図しない退会処理 等
    - ログイン後の利用者のみが編集可能な設定の変更
        - 利用者情報の公開範囲の意図しない変更 等
- 根本的解決
    - HTTP レスポンスヘッダに、X-Frame-Options ヘッダフィールドを出力し、他ドメ
    インのサイトからの frame 要素や iframe 要素による読み込みを制限する。
    - 処理を実行する直前のページで再度パスワードの入力を求め、実行ページでは、再
    度入力されたパスワードが正しい場合のみ処理を実行する。
- 保険的対策
    - 重要な処理は、一連の操作をマウスのみで実行できないようにする。

### バッファオーバーフロー

- 発生しうる脅威
    - プログラムの異常終了
        - 意図しないサービス停止
    - 任意のコード実行
        - ウイルス、ワーム、ボット等への感染、バックドアの設置、
        他のシステムへ攻撃、重要情報の漏えい 等
- 根本的解決
    - 直接メモリにアクセスできない言語で記述する。
    - 直接メモリにアクセスできる言語で記述する部分を最小限にする。
    - 脆弱性が修正されたバージョンのライブラリを使用する。
    

### アクセス制御や認可制御の欠落

#### アクセス制御の欠落

- アクセス制御機能による防御措置が必要とされるウェブサイトには、パスワード等の秘密情報の入力を必要とする認証機能を設ける。

#### 認可制御の欠落

- 認証機能に加えて認可制御の処理を実装し、ログイン中の利用者が他人になりすま
### WAF によるウェブアプリケーションの保護
- 脆弱性を悪用した攻撃からウェブアプリケーションを防御する
- 脆弱性を悪用した攻撃を検出する
- 複数のウェブアプリケーションへの攻撃をまとめて防御する
してアクセスできないようにする。
#### WAFが有用な場合
- 開発者にウェブアプリケーションの改修を依頼できない状況
- 改修できないウェブアプリケーションに脆弱性が発見された状況
#### WAF における偽陽性と偽陰性
- 偽陽性 と 偽陰性に気をつける必要がある
    - 本来、通過して良いものが通過できず<br>防御するものが通過する
## 感じたこと
- インプットが多かった
- パスワードの部分やHTTPSを使って暗号化するなど<br>意外とセキュリティを意識していたこともあったと気づいた
## 次やること
- SPA課題
## 学習時間
- Today: 6h
- Total: 1444h