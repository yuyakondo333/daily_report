# 今日学んだこと
## 取り組んだ課題
- GolangとReactでtwitterクローンを作る
## わかったこと
- **従来のWeb**: サーバーがHTMLを返す、セッション管理
- **SPA**: APIでJSONやり取り、フロントが状態管理
- **django-allauth**: 従来型Web向けなのでSPAでは直接使えない

### dj-rest-auth

- django-allauthをSPA向けにAPIとして使えるようにするライブラリ。

### 実装手順

#### 1. パッケージインストール

```bash
pip install dj-rest-auth
pip install requests
pip install django-cors-headers
```

#### 2. settings.py設定

```python
INSTALLED_APPS = [
    # 既存の設定...
    'rest_framework',
    'rest_framework.authtoken',  # トークン認証用
    'corsheaders',  # CORS対応
    'allauth',
    'allauth.account',
    'allauth.socialaccount',  # 必須
    'dj_rest_auth',
    'dj_rest_auth.registration',  # 新規登録用
]

MIDDLEWARE = [
    'corsheaders.middleware.CorsMiddleware',  # 最上位
    # 既存のミドルウェア...
]

# CORS設定（React用）
CORS_ALLOWED_ORIGINS = [
    "http://localhost:8000",  # Django
    "http://localhost:5173",  # React (Vite)
]

# DRF認証設定
REST_FRAMEWORK = {
    'DEFAULT_AUTHENTICATION_CLASSES': [
        'rest_framework.authentication.SessionAuthentication',
        'rest_framework.authentication.TokenAuthentication',
    ],
}
```

#### 3. マイグレーション実行

```bash
python manage.py migrate
```

#### 4. URL設定

```python
# api/urls.py
urlpatterns = [
    path("v1/dj-rest-auth/registration/", include("dj_rest_auth.registration.urls")),
]
```

### 重要な概念

#### トークン認証
- ログイン時にトークン発行
- ReactがAPIリクエスト時にトークンを送信
- セッションよりSPAに適している

#### CORS
- React（localhost:3000）とDjango（localhost:8000）の異なるドメイン間通信を許可
- ブラウザのセキュリティ制限を解除

## 感じたこと
- SPA（Django+React）とDjangoのみの場合で開発方法がかなり違う
    - 認証の部分はdjango-allauthだけで良いと考えていたが、そうではない
    - なぜトークン認証とCORSが必要なのか理解した
## 次やること
- フロントとの接続
## 学習時間
- Today: 6h
- Total: 1463.5h